<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.min.js" type="text/javascript"></script>

<script>
var lastReadOk=null;
var id=0;

//The check interval. Should be configurable
var interval=30000;
var url="http://www.eb.dk/dfgdfg"

function callServer() {
	$.ajax({
		type: "GET", 
		url: 	localStorage['url'],
		cache: false,
		success: function(data,status,req) {
			if(!lastReadOk){
				lastReadOk=true;
				chrome.browserAction.setIcon({path:"icons/green_light.png"});
				var okNotification = webkitNotifications.createNotification(
				  'icons/green_light.png',  // icon url - can be relative
				  localStorage['url'],  // notification title
				  'Server is running '  // notification body text
				);
				showNotification(okNotification);
			}
		},
		error: function(req,status,error) {
			if(lastReadOk||lastReadOk===null){
				lastReadOk=false;
				chrome.browserAction.setIcon({path:"icons/red_light.png"});
				var errorNotification = webkitNotifications.createNotification(
				  'icons/red_light.png',  // icon url - can be relative
				  localStorage['url'],  // notification title
				  'Server is not running'  // notification body text
				);
				showNotification(errorNotification);
			}
		}
	});
}

function showNotification(notification){
	notification.show();
	setTimeout(function(){
		notification.cancel();
	},5000);
	
}

function startService(){
	callServer();
	id=setInterval(callServer,interval);
}

function stopService() {
	clearInterval(id);
	id=0;
}

function isServiceRunning(){
	return id!=0;
}
</script>